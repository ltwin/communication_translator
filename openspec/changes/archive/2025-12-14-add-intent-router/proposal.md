# 提案：新增智能意图路由

## 变更 ID
`add-intent-router`

## 摘要
新增智能路由 Agent，自动识别用户输入内容的意图类型（产品需求/技术方案），替代用户手动选择翻译方向。

## 背景与动机

### 当前状态
- 用户需要手动选择翻译方向（`product_to_dev` 或 `dev_to_product`）
- 前端提供两个单选按钮供用户选择
- API 强制要求 `direction` 字段

### 问题
1. 用户体验不够智能 - 用户已经知道自己输入的是什么内容，还需要手动选择方向
2. 选错方向会导致翻译结果不符合预期
3. 无法支持混合内容场景（如：产品经理描述需求时夹带技术术语）

### 期望状态
- 后端自动识别输入内容的类型
- 前端可选择「智能模式」或「手动模式」
- 提供更流畅的用户体验

## 变更范围

### 新增功能
1. **意图识别 Agent** - 分析输入内容，判断属于产品需求还是技术方案
2. **智能路由模式** - API 支持自动选择翻译方向
3. **前端智能模式** - 新增「智能识别」选项

### 影响范围
- `src/router.py` (新增)
- `src/prompts.py` (新增意图识别提示词)
- `src/models.py` (修改请求模型)
- `src/main.py` (修改翻译接口)
- `static/index.html` (新增智能模式选项)
- `static/app.js` (支持智能模式)

## 技术方案概述

### 架构设计
采用 Agent 路由模式：
```
用户输入 → 意图识别 Agent → 路由决策 → 翻译 Agent → 输出
```

### 意图识别方案
使用 LLM 进行意图分类，返回结构化结果：
- `product_to_dev`: 输入为产品需求描述
- `dev_to_product`: 输入为技术方案描述
- `confidence`: 置信度分数 (0-1)

### API 变更
```python
class TranslateRequest(BaseModel):
    content: str
    direction: Optional[TranslationDirection] = None  # None 表示自动识别
    auto_detect: bool = False  # 是否启用智能路由
```

## 风险评估

### 技术风险
| 风险 | 级别 | 缓解措施 |
|-----|-----|---------|
| 意图识别准确率不足 | 中 | 提供置信度分数，低置信度时提示用户确认 |
| 额外 API 调用增加延迟 | 低 | 使用轻量级提示词，优化响应时间 |
| 成本增加 | 低 | 意图识别使用较短的 prompt，token 消耗可控 |

### 兼容性
- **向后兼容**：保留 `direction` 字段，手动指定时跳过意图识别
- **前端兼容**：新增选项而非替换，用户可选择使用方式

## 成功标准
1. 意图识别准确率 ≥ 90%
2. 智能路由增加的延迟 ≤ 500ms
3. 用户可随时切换智能/手动模式

## 相关规范
- `specs/intent-routing/spec.md` - 意图路由功能规范
