# 规范：智能意图路由

## 功能概述
智能意图路由功能允许系统自动识别用户输入内容的类型（产品需求/技术方案），并自动选择正确的翻译方向，无需用户手动指定。

---

## 新增需求

### 需求：意图识别服务

系统**必须**提供意图识别服务，能够分析用户输入内容并判断其类型。

#### 场景：识别产品需求描述

**假设** 用户输入内容为产品需求描述（如"我们需要一个智能推荐功能，提升用户停留时长"）
**当** 系统对输入内容进行意图识别
**则** 系统应返回 `direction: product_to_dev` 和置信度分数

#### 场景：识别技术方案描述

**假设** 用户输入内容为技术方案描述（如"我们优化了数据库索引，查询QPS提升了30%"）
**当** 系统对输入内容进行意图识别
**则** 系统应返回 `direction: dev_to_product` 和置信度分数

#### 场景：处理模糊内容

**假设** 用户输入内容难以明确分类（置信度 < 0.5）
**当** 系统对输入内容进行意图识别
**则** 系统应返回低置信度分数，并建议用户手动选择翻译方向

---

### 需求：智能路由翻译接口

翻译接口**必须**支持自动意图识别模式，在用户未指定翻译方向时自动选择。

#### 场景：启用智能模式未指定方向

**假设** 用户请求翻译，设置 `auto_detect: true` 且未指定 `direction`
**当** 系统处理翻译请求
**则** 系统应先进行意图识别，然后根据识别结果选择翻译方向执行翻译

#### 场景：手动指定方向优先

**假设** 用户请求翻译，同时设置 `auto_detect: true` 和 `direction: product_to_dev`
**当** 系统处理翻译请求
**则** 系统应忽略 `auto_detect`，直接按指定的 `direction` 执行翻译

#### 场景：未启用智能模式且未指定方向

**假设** 用户请求翻译，`auto_detect: false` 且未指定 `direction`
**当** 系统处理翻译请求
**则** 系统应返回 400 错误，提示需要指定翻译方向

---

### 需求：识别结果元数据

在智能模式下，系统**必须**在翻译结果中包含意图识别的元数据信息。

#### 场景：返回识别元数据

**假设** 用户使用智能模式发起翻译请求
**当** 系统完成意图识别
**则** 系统应在 SSE 流的开头返回 `[META]` 标记，包含 `detected_direction` 和 `confidence` 信息

#### 场景：高置信度直接翻译

**假设** 意图识别置信度 ≥ 0.8
**当** 系统执行翻译
**则** 系统应直接执行翻译，不添加额外提示

#### 场景：中等置信度添加提示

**假设** 意图识别置信度在 0.5 - 0.8 之间
**当** 系统执行翻译
**则** 系统应在翻译结果前添加提示："系统自动识别翻译方向，如有误请手动选择"

---

### 需求：前端智能模式支持

前端**必须**提供智能模式选项，允许用户选择自动识别或手动指定翻译方向。

#### 场景：选择智能模式

**假设** 用户在前端选择"智能识别"选项
**当** 用户点击翻译按钮
**则** 前端应发送 `auto_detect: true` 且不指定 `direction`

#### 场景：选择手动模式

**假设** 用户在前端选择"产品→开发"或"开发→产品"选项
**当** 用户点击翻译按钮
**则** 前端应发送指定的 `direction` 且 `auto_detect: false`

#### 场景：显示识别结果

**假设** 前端收到包含 `[META]` 标记的 SSE 响应
**当** 前端解析响应
**则** 前端应提取并显示识别的翻译方向信息

---

## 非功能需求

### 性能要求

- 意图识别响应时间应 ≤ 500ms
- 智能模式总体延迟增加应 ≤ 600ms（相比手动模式）

### 准确性要求

- 意图识别准确率应 ≥ 90%（基于测试用例集）
- 高置信度（≥ 0.8）识别的准确率应 ≥ 95%

### 兼容性要求

- 现有 API 调用方式应完全向后兼容
- 前端应支持手动模式作为默认或降级选项
